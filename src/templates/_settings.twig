{% import '_includes/forms' as forms %}

{% import 'postie/_macros' as macros %}

{% do view.registerAssetBundle("fireclaytile\\flatworld\\assetbundles\\flatworld\\FlatworldAsset") %}

{% set productTypes = [] %}

{% for productType in craft.commerce.productTypes.allProductTypes %}
    {% set productTypes = productTypes|merge([{
        label: productType.name,
        value: productType.handle
    }]) %}
{% endfor %}

{% set productLines = [{ label: 'N/A', value: ''}] %}

{% for productLine in craft.categories().group('productLines').all() %}
    {% set productLines = productLines|merge([{
        label: productLine.title,
        value: productLine.slug
    }]) %}
{% endfor %}

{{ forms.autosuggestField({
    label: 'API URL' | t('postie'),
    instructions: 'Enter your {name} API URL here.' | t('postie', { name: provider.displayName() }),
    id: 'apiUrl',
    name: 'apiUrl',
    value: provider.settings.apiUrl ?? '',
    required: true,
    suggestEnvVars: true,
    warning: macros.configWarning('providers.' ~ provider.handle ~ '.settings.apiUrl', 'postie'),
}) }}

{{ forms.autosuggestField({
    label: 'Username' | t('postie'),
    instructions: 'Enter your {name} Username here.' | t('postie', { name: provider.displayName() }),
    id: 'username',
    name: 'username',
    value: provider.settings.username ?? '',
    required: true,
    suggestEnvVars: true,
    warning: macros.configWarning('providers.' ~ provider.handle ~ '.settings.username', 'postie'),
}) }}

{{ forms.autosuggestField({
    label: 'License ID' | t('postie'),
    instructions: 'Enter your {name} License ID here.' | t('postie', { name: provider.displayName() }),
    id: 'licenseId',
    name: 'licenseId',
    value: provider.settings.licenseId ?? '',
    required: true,
    suggestEnvVars: true,
    warning: macros.configWarning('providers.' ~ provider.handle ~ '.settings.licenseId', 'postie'),
}) }}

{{ forms.autosuggestField({
    label: 'License Key' | t('postie'),
    instructions: 'Enter your {name} License Key here.' | t('postie', { name: provider.displayName() }),
    id: 'licenseKey',
    name: 'licenseKey',
    value: provider.settings.licenseKey ?? '',
    required: true,
    suggestEnvVars: true,
    warning: macros.configWarning('providers.' ~ provider.handle ~ '.settings.licenseKey', 'postie'),
}) }}

{{ forms.autosuggestField({
    label: 'UPS License ID' | t('postie'),
    instructions: 'Enter your {name} UPS License ID here.' | t('postie', { name: provider.displayName() }),
    id: 'upsLicenseId',
    name: 'upsLicenseId',
    value: provider.settings.upsLicenseId ?? '',
    required: true,
    suggestEnvVars: true,
    warning: macros.configWarning('providers.' ~ provider.handle ~ '.settings.upsLicenseId', 'postie'),
}) }}

{{ forms.autosuggestField({
    label: 'Total Max Weight' | t('postie'),
    instructions: 'Enter the total max weight in lbs here.' | t('postie', { name: provider.displayName() }),
    id: 'totalMaxWeight',
    name: 'totalMaxWeight',
    value: provider.settings.totalMaxWeight ?? '',
    required: true,
    suggestEnvVars: true,
    warning: macros.configWarning('providers.' ~ provider.handle ~ '.settings.totalMaxWeight', 'postie'),
}) }}

{{ forms.autosuggestField({
    label: 'Weight Threshold' | t('postie'),
    instructions: 'Enter the weight threshold here. This value is used to determine whether a single box or pallet is used as the packing method.' | t('postie', { name: provider.displayName() }),
    id: 'weightThreshold',
    name: 'weightThreshold',
    value: provider.settings.weightThreshold ?? '',
    required: true,
    suggestEnvVars: true,
    warning: macros.configWarning('providers.' ~ provider.handle ~ '.settings.weightThreshold', 'postie'),
}) }}

{{ forms.autosuggestField({
    label: 'Weight Limit Message' | t('postie'),
    instructions: 'Enter the weight limit message here.' | t('postie', { name: provider.displayName() }),
    id: 'weightLimitMessage',
    name: 'weightLimitMessage',
    value: provider.settings.weightLimitMessage ?? 'Shipping weight limit reached.',
    required: true,
    suggestEnvVars: true,
    warning: macros.configWarning('providers.' ~ provider.handle ~ '.settings.weightLimitMessage', 'postie'),
}) }}

{{ forms.editableTableField({
    label: 'Weight Per Square Foot' | t('postie'),
    instructions: 'Enter each product type and its weight per square foot here.' | t('postie', { name: provider.displayName() }),
    id: 'weightPerSquareFoot',
    name: 'weightPerSquareFoot',
    cols: [
        {
            heading : 'Product Type',
            type: 'select',
            options: productTypes
        }, {
            heading : 'Product Line',
            type: 'select',
            options: productLines
        }, {
            heading : 'Weight Per Square Foot',
            type: 'singleline'
        },
    ],
    rows: provider.settings.weightPerSquareFoot ?? [],
    required: true,
    warning: macros.configWarning('providers.' ~ provider.handle ~ '.settings.weightPerSquareFoot', 'postie'),
}) }}

{{ forms.lightswitchField({
    label: 'Display Debug Messages' | t('postie'),
    instructions: 'Whether logging debug messages should be enabled.' | t('postie', { name: provider.displayName() }),
    id: 'displayDebugMessages',
    name: 'displayDebugMessages',
    on: provider.settings.displayDebugMessages ?? false,
    required: true,
    warning: macros.configWarning('providers.' ~ provider.handle ~ '.settings.displayDebugMessages', 'postie'),
}) }}

{{ forms.autosuggestField({
    label: 'Flat Rate Carrier Name' | t('postie'),
    instructions: 'Enter the Flat Rate Carrier Name here.' | t('postie', { name: provider.displayName() }),
    id: 'flatRateCarrierName',
    name: 'flatRateCarrierName',
    value: provider.settings.flatRateCarrierName ?? '',
    required: true,
    suggestEnvVars: true,
    warning: macros.configWarning('providers.' ~ provider.handle ~ '.settings.flatRateCarrierName', 'postie'),
}) }}

{{ forms.autosuggestField({
    label: 'Flat Rate Carrier Cost' | t('postie'),
    instructions: 'Enter the Flat Rate Carrier Cost here.' | t('postie', { name: provider.displayName() }),
    id: 'flatRateCarrierCost',
    name: 'flatRateCarrierCost',
    value: provider.settings.flatRateCarrierCost ?? '',
    required: true,
    suggestEnvVars: true,
    warning: macros.configWarning('providers.' ~ provider.handle ~ '.settings.flatRateCarrierCost', 'postie'),
}) }}
